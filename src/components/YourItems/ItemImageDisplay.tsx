import { useEffect, useState } from "react";
import { Button, Frame } from "react95";

interface ImageDisplayProps {
  src: string;
  collectionItemName: string;
  tokenId: number | string;
  templateId: number;
  pixelSrc: string;
}

const FLUNKS_BACKGROUND = `data:image/svg+xml,<svg id='patternId' width='100%' height='100%' xmlns='http://www.w3.org/2000/svg'><defs><pattern id='a' patternUnits='userSpaceOnUse' width='45.88' height='100' patternTransform='scale(4) rotate(0)'><rect x='0' y='0' width='100%' height='100%' fill='hsla(0, 0%, 100%, 0)'/><path d='M-.51 13.99a7.7 7.7 0 0 0-5.37 2.15l-6.1 5.9-1.94 1.88-5.72 5.53c-.11.1-.24.19-.36.28v5.58A7.5 7.5 0 0 0-18.08 34l8.04-7.78 5.72-5.53a5.52 5.52 0 0 1 7.62 0l5.7 5.5-.03.03.02.02 1.95 1.88L17.02 34a7.77 7.77 0 0 0 10.73 0l6.1-5.9 1.95-1.88 5.72-5.53a5.52 5.52 0 0 1 7.61 0l5.72 5.53 1.94 1.88 6.1 5.9c.87.84 1.9 1.4 2.99 1.75V30.4c-.51-.25-1-.55-1.43-.96l-5.71-5.53-1.95-1.88-6.1-5.9a7.77 7.77 0 0 0-10.73 0l-6.1 5.9-1.95 1.88-5.71 5.53a5.52 5.52 0 0 1-7.62 0l-5.7-5.51.02-.02-.02-.02-1.94-1.88-6.08-5.88a7.7 7.7 0 0 0-5.37-2.15zm0 62.32a7.7 7.7 0 0 0-5.37 2.15l-6.1 5.9-1.94 1.89-5.72 5.53c-.11.1-.24.19-.36.28v5.58a7.5 7.5 0 0 0 1.92-1.31l8.04-7.78 5.72-5.53a5.52 5.52 0 0 1 7.62 0l5.7 5.5-.03.03.02.02 1.95 1.88 6.08 5.88a7.77 7.77 0 0 0 10.73 0l6.1-5.9 1.95-1.88 5.72-5.53a5.52 5.52 0 0 1 7.61 0l5.72 5.53 1.94 1.88 6.1 5.9c.87.84 1.9 1.4 2.99 1.75v-5.34c-.51-.24-1-.55-1.43-.96l-5.71-5.53-1.95-1.88-6.1-5.9a7.77 7.77 0 0 0-10.73 0l-6.1 5.9-1.95 1.88-5.71 5.53a5.52 5.52 0 0 1-7.62 0l-5.7-5.51.02-.02-.02-.02-1.94-1.88-6.08-5.89a7.7 7.7 0 0 0-5.37-2.15z'  stroke-width='1' stroke='none' fill='hsla(259, 0%, 100%, 0.51)'/><path d='M-.51 1.52a7.7 7.7 0 0 0-5.37 2.15l-6.1 5.9-1.94 1.89-5.72 5.52-.36.29v5.58a7.5 7.5 0 0 0 1.92-1.31l8.04-7.79 5.72-5.53a5.52 5.52 0 0 1 7.62 0L9 13.73l-.03.02.02.02 1.95 1.88 6.08 5.89a7.77 7.77 0 0 0 10.73 0l6.1-5.9 1.95-1.89 5.72-5.53a5.52 5.52 0 0 1 7.61 0l5.72 5.53 1.94 1.88 6.1 5.9c.87.84 1.9 1.4 2.99 1.75v-5.34c-.51-.24-1-.55-1.43-.96l-5.71-5.52-1.95-1.89-6.1-5.9a7.77 7.77 0 0 0-10.73 0l-6.1 5.9-1.95 1.89-5.71 5.52a5.52 5.52 0 0 1-7.62 0l-5.7-5.5.02-.02-.02-.03-1.94-1.88-6.08-5.88A7.7 7.7 0 0 0-.51 1.52zm0 37.4a7.7 7.7 0 0 0-5.37 2.15l-6.1 5.9-1.94 1.88-5.72 5.53c-.11.1-.24.19-.36.28v5.58a7.5 7.5 0 0 0 1.92-1.3l8.04-7.8 5.72-5.52a5.52 5.52 0 0 1 7.62 0l5.7 5.5-.03.03.02.02 1.95 1.88 6.08 5.88a7.77 7.77 0 0 0 10.73 0l6.1-5.9 1.95-1.88 5.72-5.53a5.52 5.52 0 0 1 7.61 0l5.72 5.53 1.94 1.88 6.1 5.9c.87.84 1.9 1.4 2.99 1.75v-5.34c-.51-.24-1-.55-1.43-.96l-5.71-5.53-1.95-1.88-6.1-5.9a7.77 7.77 0 0 0-10.73 0l-6.1 5.9-1.95 1.88-5.71 5.53a5.52 5.52 0 0 1-7.62 0l-5.7-5.5.02-.03-.02-.02-1.94-1.88-6.08-5.88a7.7 7.7 0 0 0-5.37-2.15zm0 24.93A7.7 7.7 0 0 0-5.88 66l-6.1 5.9-1.94 1.89-5.72 5.52-.36.29v5.57a7.5 7.5 0 0 0 1.92-1.3l8.04-7.79 5.72-5.53a5.52 5.52 0 0 1 7.62 0L9 76.06l-.03.02.02.02 1.95 1.88 6.08 5.88a7.77 7.77 0 0 0 10.73 0l6.1-5.9 1.95-1.88 5.72-5.53a5.52 5.52 0 0 1 7.61 0l5.72 5.53 1.94 1.88 6.1 5.9c.87.84 1.9 1.4 2.99 1.75v-5.34c-.51-.24-1-.55-1.43-.96l-5.71-5.52-1.95-1.89-6.1-5.9a7.77 7.77 0 0 0-10.73 0l-6.1 5.9-1.95 1.89-5.71 5.52a5.52 5.52 0 0 1-7.62 0l-5.7-5.5.02-.02-.02-.03-1.94-1.88L4.86 66a7.7 7.7 0 0 0-5.37-2.15z'  stroke-width='1' stroke='none' fill='hsla(259, 0%, 100%, 0.51)'/><path d='M-.51-10.95A7.7 7.7 0 0 0-5.88-8.8l-6.1 5.9L-13.92-1l-5.72 5.53c-.11.1-.24.18-.36.28v5.58a7.5 7.5 0 0 0 1.92-1.31l8.04-7.78 5.72-5.53a5.52 5.52 0 0 1 7.62 0L9 1.26l-.03.03.02.01 1.95 1.89 6.08 5.88a7.77 7.77 0 0 0 10.73 0l6.1-5.9 1.95-1.88 5.72-5.53a5.52 5.52 0 0 1 7.61 0l5.72 5.53 1.94 1.88 6.1 5.9c.87.83 1.9 1.4 2.99 1.74V5.48c-.51-.25-1-.55-1.43-.96l-5.71-5.53-1.95-1.88-6.1-5.9a7.77 7.77 0 0 0-10.73 0l-6.1 5.9-1.95 1.88-5.71 5.53a5.52 5.52 0 0 1-7.62 0L12.88-1l.02-.02-.02-.02-1.94-1.88L4.86-8.8a7.7 7.7 0 0 0-5.37-2.15zm0 37.4a7.7 7.7 0 0 0-5.37 2.15l-6.1 5.9-1.94 1.89-5.72 5.52c-.11.11-.24.2-.36.29v5.58a7.5 7.5 0 0 0 1.92-1.31l8.04-7.79 5.72-5.53a5.52 5.52 0 0 1 7.62 0L9 38.66l-.03.02.02.02 1.95 1.88 6.08 5.89a7.77 7.77 0 0 0 10.73 0l6.1-5.9 1.95-1.89 5.72-5.53a5.52 5.52 0 0 1 7.61 0l5.72 5.53 1.94 1.88 6.1 5.9c.87.84 1.9 1.4 2.99 1.75v-5.33c-.51-.25-1-.55-1.43-.97l-5.71-5.52-1.95-1.89-6.1-5.9a7.77 7.77 0 0 0-10.73 0l-6.1 5.9-1.95 1.89-5.71 5.52a5.52 5.52 0 0 1-7.62 0l-5.7-5.5.02-.02-.02-.02-1.94-1.88-6.08-5.89a7.7 7.7 0 0 0-5.37-2.15zm0 24.93a7.7 7.7 0 0 0-5.37 2.15l-6.1 5.9-1.94 1.89-5.72 5.53c-.11.1-.24.18-.36.28v5.58a7.5 7.5 0 0 0 1.92-1.31l8.04-7.78 5.72-5.53a5.52 5.52 0 0 1 7.62 0l5.7 5.5-.03.03.02.01 1.95 1.89 6.08 5.88a7.77 7.77 0 0 0 10.73 0l6.1-5.9 1.95-1.88 5.72-5.53a5.52 5.52 0 0 1 7.61 0l5.72 5.53 1.94 1.88 6.1 5.9c.87.83 1.9 1.4 2.99 1.74v-5.33c-.51-.25-1-.55-1.43-.96l-5.71-5.53-1.95-1.88-6.1-5.9a7.77 7.77 0 0 0-10.73 0l-6.1 5.9-1.95 1.88-5.71 5.53a5.52 5.52 0 0 1-7.62 0l-5.7-5.51.02-.02-.02-.02-1.94-1.88-6.08-5.89a7.7 7.7 0 0 0-5.37-2.15zm0 37.4a7.7 7.7 0 0 0-5.37 2.15l-6.1 5.9-1.94 1.89-5.72 5.52c-.11.11-.24.19-.36.29v5.58a7.5 7.5 0 0 0 1.92-1.31l8.04-7.79 5.72-5.53a5.52 5.52 0 0 1 7.62 0L9 101l-.03.02.02.02 1.95 1.88 6.08 5.89a7.77 7.77 0 0 0 10.73 0l6.1-5.9L35.8 101l5.72-5.53a5.52 5.52 0 0 1 7.61 0l5.72 5.53 1.94 1.88 6.1 5.9c.87.84 1.9 1.4 2.99 1.75v-5.33c-.51-.25-1-.56-1.43-.97l-5.71-5.52-1.95-1.89-6.1-5.9a7.77 7.77 0 0 0-10.73 0l-6.1 5.9-1.95 1.89-5.71 5.52a5.52 5.52 0 0 1-7.62 0l-5.7-5.5.02-.02-.02-.02-1.94-1.88-6.08-5.89a7.7 7.7 0 0 0-5.37-2.15z'  stroke-width='1' stroke='none' fill='hsla(259, 0%, 100%, 0.51)'/></pattern></defs><rect width='800%' height='800%' transform='translate(0,0)' fill='url(%23a)'/></svg>`;
const BACKPACK_BACKGROUND = `data:image/svg+xml,<svg id='patternId' width='100%' height='100%' xmlns='http://www.w3.org/2000/svg'><defs><pattern id='a' patternUnits='userSpaceOnUse' width='45.88' height='100' patternTransform='scale(4) rotate(0)'><rect x='0' y='0' width='100%' height='100%' fill='hsla(0, 0%, 100%, 0)'/><path d='M-.51 13.99a7.7 7.7 0 0 0-5.37 2.15l-6.1 5.9-1.94 1.88-5.72 5.53c-.11.1-.24.19-.36.28v5.58A7.5 7.5 0 0 0-18.08 34l8.04-7.78 5.72-5.53a5.52 5.52 0 0 1 7.62 0l5.7 5.5-.03.03.02.02 1.95 1.88L17.02 34a7.77 7.77 0 0 0 10.73 0l6.1-5.9 1.95-1.88 5.72-5.53a5.52 5.52 0 0 1 7.61 0l5.72 5.53 1.94 1.88 6.1 5.9c.87.84 1.9 1.4 2.99 1.75V30.4c-.51-.25-1-.55-1.43-.96l-5.71-5.53-1.95-1.88-6.1-5.9a7.77 7.77 0 0 0-10.73 0l-6.1 5.9-1.95 1.88-5.71 5.53a5.52 5.52 0 0 1-7.62 0l-5.7-5.51.02-.02-.02-.02-1.94-1.88-6.08-5.88a7.7 7.7 0 0 0-5.37-2.15zm0 62.32a7.7 7.7 0 0 0-5.37 2.15l-6.1 5.9-1.94 1.89-5.72 5.53c-.11.1-.24.19-.36.28v5.58a7.5 7.5 0 0 0 1.92-1.31l8.04-7.78 5.72-5.53a5.52 5.52 0 0 1 7.62 0l5.7 5.5-.03.03.02.02 1.95 1.88 6.08 5.88a7.77 7.77 0 0 0 10.73 0l6.1-5.9 1.95-1.88 5.72-5.53a5.52 5.52 0 0 1 7.61 0l5.72 5.53 1.94 1.88 6.1 5.9c.87.84 1.9 1.4 2.99 1.75v-5.34c-.51-.24-1-.55-1.43-.96l-5.71-5.53-1.95-1.88-6.1-5.9a7.77 7.77 0 0 0-10.73 0l-6.1 5.9-1.95 1.88-5.71 5.53a5.52 5.52 0 0 1-7.62 0l-5.7-5.51.02-.02-.02-.02-1.94-1.88-6.08-5.89a7.7 7.7 0 0 0-5.37-2.15z'  stroke-width='1' stroke='none' fill='hsla(259, 0%, 100%, 0.51)'/><path d='M-.51 1.52a7.7 7.7 0 0 0-5.37 2.15l-6.1 5.9-1.94 1.89-5.72 5.52-.36.29v5.58a7.5 7.5 0 0 0 1.92-1.31l8.04-7.79 5.72-5.53a5.52 5.52 0 0 1 7.62 0L9 13.73l-.03.02.02.02 1.95 1.88 6.08 5.89a7.77 7.77 0 0 0 10.73 0l6.1-5.9 1.95-1.89 5.72-5.53a5.52 5.52 0 0 1 7.61 0l5.72 5.53 1.94 1.88 6.1 5.9c.87.84 1.9 1.4 2.99 1.75v-5.34c-.51-.24-1-.55-1.43-.96l-5.71-5.52-1.95-1.89-6.1-5.9a7.77 7.77 0 0 0-10.73 0l-6.1 5.9-1.95 1.89-5.71 5.52a5.52 5.52 0 0 1-7.62 0l-5.7-5.5.02-.02-.02-.03-1.94-1.88-6.08-5.88A7.7 7.7 0 0 0-.51 1.52zm0 37.4a7.7 7.7 0 0 0-5.37 2.15l-6.1 5.9-1.94 1.88-5.72 5.53c-.11.1-.24.19-.36.28v5.58a7.5 7.5 0 0 0 1.92-1.3l8.04-7.8 5.72-5.52a5.52 5.52 0 0 1 7.62 0l5.7 5.5-.03.03.02.02 1.95 1.88 6.08 5.88a7.77 7.77 0 0 0 10.73 0l6.1-5.9 1.95-1.88 5.72-5.53a5.52 5.52 0 0 1 7.61 0l5.72 5.53 1.94 1.88 6.1 5.9c.87.84 1.9 1.4 2.99 1.75v-5.34c-.51-.24-1-.55-1.43-.96l-5.71-5.53-1.95-1.88-6.1-5.9a7.77 7.77 0 0 0-10.73 0l-6.1 5.9-1.95 1.88-5.71 5.53a5.52 5.52 0 0 1-7.62 0l-5.7-5.5.02-.03-.02-.02-1.94-1.88-6.08-5.88a7.7 7.7 0 0 0-5.37-2.15zm0 24.93A7.7 7.7 0 0 0-5.88 66l-6.1 5.9-1.94 1.89-5.72 5.52-.36.29v5.57a7.5 7.5 0 0 0 1.92-1.3l8.04-7.79 5.72-5.53a5.52 5.52 0 0 1 7.62 0L9 76.06l-.03.02.02.02 1.95 1.88 6.08 5.88a7.77 7.77 0 0 0 10.73 0l6.1-5.9 1.95-1.88 5.72-5.53a5.52 5.52 0 0 1 7.61 0l5.72 5.53 1.94 1.88 6.1 5.9c.87.84 1.9 1.4 2.99 1.75v-5.34c-.51-.24-1-.55-1.43-.96l-5.71-5.52-1.95-1.89-6.1-5.9a7.77 7.77 0 0 0-10.73 0l-6.1 5.9-1.95 1.89-5.71 5.52a5.52 5.52 0 0 1-7.62 0l-5.7-5.5.02-.02-.02-.03-1.94-1.88L4.86 66a7.7 7.7 0 0 0-5.37-2.15z'  stroke-width='1' stroke='none' fill='hsla(259, 0%, 100%, 0.51)'/><path d='M-.51-10.95A7.7 7.7 0 0 0-5.88-8.8l-6.1 5.9L-13.92-1l-5.72 5.53c-.11.1-.24.18-.36.28v5.58a7.5 7.5 0 0 0 1.92-1.31l8.04-7.78 5.72-5.53a5.52 5.52 0 0 1 7.62 0L9 1.26l-.03.03.02.01 1.95 1.89 6.08 5.88a7.77 7.77 0 0 0 10.73 0l6.1-5.9 1.95-1.88 5.72-5.53a5.52 5.52 0 0 1 7.61 0l5.72 5.53 1.94 1.88 6.1 5.9c.87.83 1.9 1.4 2.99 1.74V5.48c-.51-.25-1-.55-1.43-.96l-5.71-5.53-1.95-1.88-6.1-5.9a7.77 7.77 0 0 0-10.73 0l-6.1 5.9-1.95 1.88-5.71 5.53a5.52 5.52 0 0 1-7.62 0L12.88-1l.02-.02-.02-.02-1.94-1.88L4.86-8.8a7.7 7.7 0 0 0-5.37-2.15zm0 37.4a7.7 7.7 0 0 0-5.37 2.15l-6.1 5.9-1.94 1.89-5.72 5.52c-.11.11-.24.2-.36.29v5.58a7.5 7.5 0 0 0 1.92-1.31l8.04-7.79 5.72-5.53a5.52 5.52 0 0 1 7.62 0L9 38.66l-.03.02.02.02 1.95 1.88 6.08 5.89a7.77 7.77 0 0 0 10.73 0l6.1-5.9 1.95-1.89 5.72-5.53a5.52 5.52 0 0 1 7.61 0l5.72 5.53 1.94 1.88 6.1 5.9c.87.84 1.9 1.4 2.99 1.75v-5.33c-.51-.25-1-.55-1.43-.97l-5.71-5.52-1.95-1.89-6.1-5.9a7.77 7.77 0 0 0-10.73 0l-6.1 5.9-1.95 1.89-5.71 5.52a5.52 5.52 0 0 1-7.62 0l-5.7-5.5.02-.02-.02-.02-1.94-1.88-6.08-5.89a7.7 7.7 0 0 0-5.37-2.15zm0 24.93a7.7 7.7 0 0 0-5.37 2.15l-6.1 5.9-1.94 1.89-5.72 5.53c-.11.1-.24.18-.36.28v5.58a7.5 7.5 0 0 0 1.92-1.31l8.04-7.78 5.72-5.53a5.52 5.52 0 0 1 7.62 0l5.7 5.5-.03.03.02.01 1.95 1.89 6.08 5.88a7.77 7.77 0 0 0 10.73 0l6.1-5.9 1.95-1.88 5.72-5.53a5.52 5.52 0 0 1 7.61 0l5.72 5.53 1.94 1.88 6.1 5.9c.87.83 1.9 1.4 2.99 1.74v-5.33c-.51-.25-1-.55-1.43-.96l-5.71-5.53-1.95-1.88-6.1-5.9a7.77 7.77 0 0 0-10.73 0l-6.1 5.9-1.95 1.88-5.71 5.53a5.52 5.52 0 0 1-7.62 0l-5.7-5.51.02-.02-.02-.02-1.94-1.88-6.08-5.89a7.7 7.7 0 0 0-5.37-2.15zm0 37.4a7.7 7.7 0 0 0-5.37 2.15l-6.1 5.9-1.94 1.89-5.72 5.52c-.11.11-.24.19-.36.29v5.58a7.5 7.5 0 0 0 1.92-1.31l8.04-7.79 5.72-5.53a5.52 5.52 0 0 1 7.62 0L9 101l-.03.02.02.02 1.95 1.88 6.08 5.89a7.77 7.77 0 0 0 10.73 0l6.1-5.9L35.8 101l5.72-5.53a5.52 5.52 0 0 1 7.61 0l5.72 5.53 1.94 1.88 6.1 5.9c.87.84 1.9 1.4 2.99 1.75v-5.33c-.51-.25-1-.56-1.43-.97l-5.71-5.52-1.95-1.89-6.1-5.9a7.77 7.77 0 0 0-10.73 0l-6.1 5.9-1.95 1.89-5.71 5.52a5.52 5.52 0 0 1-7.62 0l-5.7-5.5.02-.02-.02-.02-1.94-1.88-6.08-5.89a7.7 7.7 0 0 0-5.37-2.15z'  stroke-width='1' stroke='none' fill='hsla(259, 0%, 100%, 0.51)'/></pattern></defs><rect width='800%' height='800%' transform='translate(0,0)' fill='url(%23a)'/></svg>`;

const ImageDisplay: React.FC<ImageDisplayProps> = ({
  src,
  collectionItemName,
  tokenId,
  templateId,
  pixelSrc,
}) => {
  const [activeImage, setActiveImage] = useState(src);

  useEffect(() => {
    // Preload pxelated image
    if (pixelSrc) {
      const img = new Image();
      img.src = pixelSrc;
    }
  }, []);

  return (
    <Frame
      className="!w-full h-auto p-4 !flex !items-center !justify-center !flex-col"
      style={{
        backgroundBlendMode: "overlay",
        backgroundImage: `url("${
          collectionItemName === "Backpack"
            ? BACKPACK_BACKGROUND
            : FLUNKS_BACKGROUND
        }")`,
      }}
    >
      <div className="flex flex-col">
        <Frame className="w-auto h-auto !flex flex-col relative min-w-full min-h-full max-w-[250px] lg:max-w-[500px] p-2">
          <Frame variant="well">
            <img src={activeImage} className="w-full h-full flex-shrink" />
          </Frame>
          {pixelSrc && (
            <Button
              className="!absolute z-10 top-4 right-4"
              onClick={() => {
                if (activeImage === src) {
                  setActiveImage(pixelSrc);
                } else {
                  setActiveImage(src);
                }
              }}
              active={activeImage === pixelSrc}
            >
              🎓
            </Button>
          )}
          <Frame
            variant="well"
            className="w-full !mb-0 !flex !items-center mt-1"
          >
            <Frame variant="field" className="w-full px-3 py-2">
              <span className="text-lg lg:text-2xl tracking-widest font-bold">
                {collectionItemName}
              </span>
            </Frame>

            <Frame
              variant="field"
              className="!w-auto !mr-auto !flex !flex-grow-0 px-3 py-2"
            >
              <span className="text-lg lg:text-2xl font-bold tracking-wide">
                #{templateId}
              </span>
            </Frame>
          </Frame>
        </Frame>
      </div>
    </Frame>
  );
};

export default ImageDisplay;
